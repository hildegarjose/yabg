#!/usr/bin/env bash

set -eu -o pipefail

_help() {
  echo
  echo "USAGE:"
  echo -e "\t<%- name %> COMMANDS"
  echo
  echo "COMMANDS:"
  echo -e "\tstart: start containers"
  echo -e "\tstop: stop containers"
  echo -e "\trestart: restart containers"
  echo -e "\taddrecord: add records to /etc/hosts"
  echo -e "\tdebug: to see services logs"
  echo -e "\thelp: print this screen"
  echo
}

_new_record() {
  local root="${1}.local"
  local mail="mail.${1}.local"
  local db="db.${1}.local"

  local record="127.0.0.1 ${root} ${mail} ${db}"

  echo "${record}" | sudo tee -a /etc/hosts
}

if [[ "${EUID}" -ne 0 ]]; then
  echo "This script MUST be run by root (sudo)"
  exit
fi

if [[ ${#} -lt 1  ]]; then
  _help
  exit
fi

case ${1} in
  "restart")
    docker-compose restart
    ;;
  "start")
    docker-compose up -d
    ;;
  "stop")
    docker-compose down
    ;;
  "debug")
    docker-compose logs
    ;;
  "addrecord")
    _new_record <%- name %>
    echo "Virtual Hosts records has been added to /etc/hosts"
    ;;
  "help")
    _help
    ;;
  *)
    echo "@@ COMMAND ERROR @@"
    _help
    ;;
esac

